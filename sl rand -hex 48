[1mdiff --git a/.env.example b/.env.example[m
[1mindex 4cef62b..29f045a 100644[m
[1m--- a/.env.example[m
[1m+++ b/.env.example[m
[36m@@ -1,23 +1,23 @@[m
[31m-# Justice Dashboard Environment Configuration[m
[31m-# Copy this file to .env and fill in your actual values[m
[31m-[m
[31m-# Required Environment Variables[m
[31m-JWT_SECRET=your-super-secure-jwt-secret-at-least-32-characters-long[m
[31m-SESSION_SECRET=your-session-secret-key-at-least-32-characters-long[m
[31m-[m
[31m-# Optional Environment Variables[m
[31m-WOLFRAM_APP_ID=your-wolfram-alpha-app-id-from-developer-portal[m
[31m-[m
[31m-# Development/Production Settings[m
[31m-NODE_ENV=development[m
[31m-PORT=3000[m
[31m-[m
[31m-# Optional API Keys (for enhanced features)[m
[31m-OPENAI_API_KEY=your-openai-api-key-for-ai-features[m
[31m-MONGODB_URI=your-mongodb-connection-string-if-using-database[m
[31m-[m
[31m-# Security Notes:[m
[31m-# - JWT_SECRET: Must be at least 32 characters long for security[m
[31m-# - SESSION_SECRET: Should be a random string at least 32 characters long[m
[31m-# - Never commit actual secrets to version control[m
[31m-# - Use strong, unique passwords for production deployments[m
[32m+[m[32m# Justice Dashboard Environment Configuration[m[41m[m
[32m+[m[32m# Copy this file to .env and fill in your actual values[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Required Environment Variables[m[41m[m
[32m+[m[32mJWT_SECRET=your-super-secure-jwt-secret-at-least-32-characters-long[m[41m[m
[32m+[m[32mSESSION_SECRET=your-session-secret-key-at-least-32-characters-long[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Optional Environment Variables[m[41m[m
[32m+[m[32mWOLFRAM_APP_ID=your-wolfram-alpha-app-id-from-developer-portal[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Development/Production Settings[m[41m[m
[32m+[m[32mNODE_ENV=development[m[41m[m
[32m+[m[32mPORT=3000[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Optional API Keys (for enhanced features)[m[41m[m
[32m+[m[32mOPENAI_API_KEY=your-openai-api-key-for-ai-features[m[41m[m
[32m+[m[32mMONGODB_URI=your-mongodb-connection-string-if-using-database[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Security Notes:[m[41m[m
[32m+[m[32m# - JWT_SECRET: Must be at least 32 characters long for security[m[41m[m
[32m+[m[32m# - SESSION_SECRET: Should be a random string at least 32 characters long[m[41m[m
[32m+[m[32m# - Never commit actual secrets to version control[m[41m[m
[32m+[m[32m# - Use strong, unique passwords for production deployments[m[41m[m
[1mdiff --git a/.gitignore b/.gitignore[m
[1mindex 8966c39..1a8fe5c 100644[m
[1m--- a/.gitignore[m
[1m+++ b/.gitignore[m
[36m@@ -1,145 +1,145 @@[m
[31m-# Node[m
[31m-node_modules/[m
[31m-[m
[31m-# Builds & temp[m
[31m-build/[m
[31m-dist/[m
[31m-uploads/[m
[31m-[m
[31m-# VS Code[m
[31m-.vscode/[m
[31m-[m
[31m-# Environment[m
[31m-.env[m
[31m-# Logs[m
[31m-logs[m
[31m-*.log[m
[31m-npm-debug.log*[m
[31m-yarn-debug.log*[m
[31m-yarn-error.log*[m
[31m-lerna-debug.log*[m
[31m-[m
[31m-# Diagnostic reports (https://nodejs.org/api/report.html)[m
[31m-report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json[m
[31m-[m
[31m-# Runtime data[m
[31m-pids[m
[31m-*.pid[m
[31m-*.seed[m
[31m-*.pid.lock[m
[31m-[m
[31m-# Directory for instrumented libs generated by jscoverage/JSCover[m
[31m-lib-cov[m
[31m-[m
[31m-# Coverage directory used by tools like istanbul[m
[31m-coverage[m
[31m-*.lcov[m
[31m-[m
[31m-# nyc test coverage[m
[31m-.nyc_output[m
[31m-[m
[31m-# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)[m
[31m-.grunt[m
[31m-[m
[31m-# Bower dependency directory (https://bower.io/)[m
[31m-bower_components[m
[31m-[m
[31m-# node-waf configuration[m
[31m-.lock-wscript[m
[31m-[m
[31m-# Compiled binary addons (https://nodejs.org/api/addons.html)[m
[31m-build/Release[m
[31m-[m
[31m-# Dependency directories[m
[31m-node_modules/[m
[31m-jspm_packages/[m
[31m-[m
[31m-# Snowpack dependency directory (https://snowpack.dev/)[m
[31m-web_modules/[m
[31m-[m
[31m-# TypeScript cache[m
[31m-*.tsbuildinfo[m
[31m-[m
[31m-# Optional npm cache directory[m
[31m-.npm[m
[31m-[m
[31m-# Optional eslint cache[m
[31m-.eslintcache[m
[31m-[m
[31m-# Optional stylelint cache[m
[31m-.stylelintcache[m
[31m-[m
[31m-# Optional REPL history[m
[31m-.node_repl_history[m
[31m-[m
[31m-# Output of 'npm pack'[m
[31m-*.tgz[m
[31m-[m
[31m-# Yarn Integrity file[m
[31m-.yarn-integrity[m
[31m-[m
[31m-# dotenv environment variable files[m
[31m-.env[m
[31m-.env.*[m
[31m-!.env.example[m
[31m-[m
[31m-# parcel-bundler cache (https://parceljs.org/)[m
[31m-.cache[m
[31m-.parcel-cache[m
[31m-[m
[31m-# Next.js build output[m
[31m-.next[m
[31m-out[m
[31m-[m
[31m-# Nuxt.js build / generate output[m
[31m-.nuxt[m
[31m-dist[m
[31m-[m
[31m-# Gatsby files[m
[31m-.cache/[m
[31m-# Comment in the public line in if your project uses Gatsby and not Next.js[m
[31m-# https://nextjs.org/blog/next-9-1#public-directory-support[m
[31m-# public[m
[31m-[m
[31m-# vuepress build output[m
[31m-.vuepress/dist[m
[31m-[m
[31m-# vuepress v2.x temp and cache directory[m
[31m-.temp[m
[31m-.cache[m
[31m-[m
[31m-# vitepress build output[m
[31m-**/.vitepress/dist[m
[31m-[m
[31m-# vitepress cache directory[m
[31m-**/.vitepress/cache[m
[31m-[m
[31m-# Docusaurus cache and generated files[m
[31m-.docusaurus[m
[31m-[m
[31m-# Serverless directories[m
[31m-.serverless/[m
[31m-[m
[31m-# FuseBox cache[m
[31m-.fusebox/[m
[31m-[m
[31m-# DynamoDB Local files[m
[31m-.dynamodb/[m
[31m-[m
[31m-# TernJS port file[m
[31m-.tern-port[m
[31m-[m
[31m-# Stores VSCode versions used for testing VSCode extensions[m
[31m-.vscode-test[m
[31m-[m
[31m-# yarn v3[m
[31m-.pnp.*[m
[31m-.yarn/*[m
[31m-!.yarn/patches[m
[31m-!.yarn/plugins[m
[31m-!.yarn/releases[m
[31m-!.yarn/sdks[m
[31m-!.yarn/versions[m
[31m-[m
[31m-# Local Netlify folder[m
[31m-.netlify[m
[32m+[m[32m# Node[m[41m[m
[32m+[m[32mnode_modules/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Builds & temp[m[41m[m
[32m+[m[32mbuild/[m[41m[m
[32m+[m[32mdist/[m[41m[m
[32m+[m[32muploads/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# VS Code[m[41m[m
[32m+[m[32m.vscode/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Environment[m[41m[m
[32m+[m[32m.env[m[41m[m
[32m+[m[32m# Logs[m[41m[m
[32m+[m[32mlogs[m[41m[m
[32m+[m[32m*.log[m[41m[m
[32m+[m[32mnpm-debug.log*[m[41m[m
[32m+[m[32myarn-debug.log*[m[41m[m
[32m+[m[32myarn-error.log*[m[41m[m
[32m+[m[32mlerna-debug.log*[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Diagnostic reports (https://nodejs.org/api/report.html)[m[41m[m
[32m+[m[32mreport.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Runtime data[m[41m[m
[32m+[m[32mpids[m[41m[m
[32m+[m[32m*.pid[m[41m[m
[32m+[m[32m*.seed[m[41m[m
[32m+[m[32m*.pid.lock[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Directory for instrumented libs generated by jscoverage/JSCover[m[41m[m
[32m+[m[32mlib-cov[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Coverage directory used by tools like istanbul[m[41m[m
[32m+[m[32mcoverage[m[41m[m
[32m+[m[32m*.lcov[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# nyc test coverage[m[41m[m
[32m+[m[32m.nyc_output[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)[m[41m[m
[32m+[m[32m.grunt[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Bower dependency directory (https://bower.io/)[m[41m[m
[32m+[m[32mbower_components[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# node-waf configuration[m[41m[m
[32m+[m[32m.lock-wscript[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Compiled binary addons (https://nodejs.org/api/addons.html)[m[41m[m
[32m+[m[32mbuild/Release[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Dependency directories[m[41m[m
[32m+[m[32mnode_modules/[m[41m[m
[32m+[m[32mjspm_packages/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Snowpack dependency directory (https://snowpack.dev/)[m[41m[m
[32m+[m[32mweb_modules/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# TypeScript cache[m[41m[m
[32m+[m[32m*.tsbuildinfo[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Optional npm cache directory[m[41m[m
[32m+[m[32m.npm[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Optional eslint cache[m[41m[m
[32m+[m[32m.eslintcache[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Optional stylelint cache[m[41m[m
[32m+[m[32m.stylelintcache[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Optional REPL history[m[41m[m
[32m+[m[32m.node_repl_history[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Output of 'npm pack'[m[41m[m
[32m+[m[32m*.tgz[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Yarn Integrity file[m[41m[m
[32m+[m[32m.yarn-integrity[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# dotenv environment variable files[m[41m[m
[32m+[m[32m.env[m[41m[m
[32m+[m[32m.env.*[m[41m[m
[32m+[m[32m!.env.example[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# parcel-bundler cache (https://parceljs.org/)[m[41m[m
[32m+[m[32m.cache[m[41m[m
[32m+[m[32m.parcel-cache[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Next.js build output[m[41m[m
[32m+[m[32m.next[m[41m[m
[32m+[m[32mout[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Nuxt.js build / generate output[m[41m[m
[32m+[m[32m.nuxt[m[41m[m
[32m+[m[32mdist[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Gatsby files[m[41m[m
[32m+[m[32m.cache/[m[41m[m
[32m+[m[32m# Comment in the public line in if your project uses Gatsby and not Next.js[m[41m[m
[32m+[m[32m# https://nextjs.org/blog/next-9-1#public-directory-support[m[41m[m
[32m+[m[32m# public[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# vuepress build output[m[41m[m
[32m+[m[32m.vuepress/dist[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# vuepress v2.x temp and cache directory[m[41m[m
[32m+[m[32m.temp[m[41m[m
[32m+[m[32m.cache[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# vitepress build output[m[41m[m
[32m+[m[32m**/.vitepress/dist[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# vitepress cache directory[m[41m[m
[32m+[m[32m**/.vitepress/cache[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Docusaurus cache and generated files[m[41m[m
[32m+[m[32m.docusaurus[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Serverless directories[m[41m[m
[32m+[m[32m.serverless/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# FuseBox cache[m[41m[m
[32m+[m[32m.fusebox/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# DynamoDB Local files[m[41m[m
[32m+[m[32m.dynamodb/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# TernJS port file[m[41m[m
[32m+[m[32m.tern-port[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Stores VSCode versions used for testing VSCode extensions[m[41m[m
[32m+[m[32m.vscode-test[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# yarn v3[m[41m[m
[32m+[m[32m.pnp.*[m[41m[m
[32m+[m[32m.yarn/*[m[41m[m
[32m+[m[32m!.yarn/patches[m[41m[m
[32m+[m[32m!.yarn/plugins[m[41m[m
[32m+[m[32m!.yarn/releases[m[41m[m
[32m+[m[32m!.yarn/sdks[m[41m[m
[32m+[m[32m!.yarn/versions[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Local Netlify folder[m[41m[m
[32m+[m[32m.netlify[m[41m[m
[1mdiff --git a/.vscode/settings.json b/.vscode/settings.json[m
[1mindex f2326bd..0cbc2cb 100644[m
[1m--- a/.vscode/settings.json[m
[1m+++ b/.vscode/settings.json[m
[36m@@ -1,10 +1,10 @@[m
[31m-{[m
[31m-  "emeraldwalk.runonsave": {[m
[31m-    "commands": [[m
[31m-      {[m
[31m-        "match": ".*",[m
[31m-        "cmd": "workbench.action.tasks.runTask Start Server"[m
[31m-      }[m
[31m-    ][m
[31m-  }[m
[32m+[m[32m{[m[41m[m
[32m+[m[32m  "emeraldwalk.runonsave": {[m[41m[m
[32m+[m[32m    "commands": [[m[41m[m
[32m+[m[32m      {[m[41m[m
[32m+[m[32m        "match": ".*",[m[41m[m
[32m+[m[32m        "cmd": "workbench.action.tasks.runTask Start Server"[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m    ][m[41m[m
[32m+[m[32m  }[m[41m[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/LICENSE b/LICENSE[m
[1mindex 6344b85..1947011 100644[m
[1m--- a/LICENSE[m
[1m+++ b/LICENSE[m
[36m@@ -1,21 +1,21 @@[m
[31m-MIT License[m
[31m-[m
[31m-Copyright (c) 2025 [Your Name][m
[31m-[m
[31m-Permission is hereby granted, free of charge, to any person obtaining a copy[m
[31m-of this software and associated documentation files (the â€œSoftwareâ€), to deal[m
[31m-in the Software without restriction, including without limitation the rights[m
[31m-to use, copy, modify, merge, publish, distribute, sublicense, and/or sell[m
[31m-copies of the Software, and to permit persons to whom the Software is[m
[31m-furnished to do so, subject to the following conditions:[m
[31m-[m
[31m-The above copyright notice and this permission notice shall be included in[m
[31m-all copies or substantial portions of the Software.[m
[31m-[m
[31m-THE SOFTWARE IS PROVIDED â€œAS ISâ€, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR[m
[31m-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,[m
[31m-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE[m
[31m-AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER[m
[31m-LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,[m
[31m-OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN[m
[32m+[m[32mMIT License[m[41m[m
[32m+[m[41m[m
[32m+[m[32mCopyright (c) 2025 [Your Name][m[41m[m
[32m+[m[41m[m
[32m+[m[32mPermission is hereby granted, free of charge, to any person obtaining a copy[m[41m[m
[32m+[m[32mof this software and associated documentation files (the â€œSoftwareâ€), to deal[m[41m[m
[32m+[m[32min the Software without restriction, including without limitation the rights[m[41m[m
[32m+[m[32mto use, copy, modify, merge, publish, distribute, sublicense, and/or sell[m[41m[m
[32m+[m[32mcopies of the Software, and to permit persons to whom the Software is[m[41m[m
[32m+[m[32mfurnished to do so, subject to the following conditions:[m[41m[m
[32m+[m[41m[m
[32m+[m[32mThe above copyright notice and this permission notice shall be included in[m[41m[m
[32m+[m[32mall copies or substantial portions of the Software.[m[41m[m
[32m+[m[41m[m
[32m+[m[32mTHE SOFTWARE IS PROVIDED â€œAS ISâ€, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR[m[41m[m
[32m+[m[32mIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,[m[41m[m
[32m+[m[32mFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE[m[41m[m
[32m+[m[32mAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER[m[41m[m
[32m+[m[32mLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,[m[41m[m
[32m+[m[32mOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN[m[41m[m
 THE SOFTWARE.[m
\ No newline at end of file[m
[1mdiff --git a/build/pdf.mjs b/build/pdf.mjs[m
[1mindex beb42d1..7bd0da9 100644[m
[1m--- a/build/pdf.mjs[m
[1m+++ b/build/pdf.mjs[m
[36m@@ -1,22634 +1,22634 @@[m
[31m-/**[m
[31m- * @licstart The following is the entire license notice for the[m
[31m- * JavaScript code in this page[m
[31m- *[m
[31m- * Copyright 2024 Mozilla Foundation[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *     http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- *[m
[31m- * @licend The above is the entire license notice for the[m
[31m- * JavaScript code in this page[m
[31m- */[m
[31m-[m
[31m-/**[m
[31m- * pdfjsVersion = 5.3.31[m
[31m- * pdfjsBuild = 47ad820d9[m
[31m- */[m
[31m-[m
[31m-;// ./src/shared/util.js[m
[31m-const isNodeJS = typeof process === "object" && process + "" === "[object process]" && !process.versions.nw && !(process.versions.electron && process.type && process.type !== "browser");[m
[31m-const FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];[m
[31m-const LINE_FACTOR = 1.35;[m
[31m-const LINE_DESCENT_FACTOR = 0.35;[m
[31m-const BASELINE_FACTOR = LINE_DESCENT_FACTOR / LINE_FACTOR;[m
[31m-const RenderingIntentFlag = {[m
[31m-  ANY: 0x01,[m
[31m-  DISPLAY: 0x02,[m
[31m-  PRINT: 0x04,[m
[31m-  SAVE: 0x08,[m
[31m-  ANNOTATIONS_FORMS: 0x10,[m
[31m-  ANNOTATIONS_STORAGE: 0x20,[m
[31m-  ANNOTATIONS_DISABLE: 0x40,[m
[31m-  IS_EDITING: 0x80,[m
[31m-  OPLIST: 0x100[m
[31m-};[m
[31m-const AnnotationMode = {[m
[31m-  DISABLE: 0,[m
[31m-  ENABLE: 1,[m
[31m-  ENABLE_FORMS: 2,[m
[31m-  ENABLE_STORAGE: 3[m
[31m-};[m
[31m-const AnnotationEditorPrefix = "pdfjs_internal_editor_";[m
[31m-const AnnotationEditorType = {[m
[31m-  DISABLE: -1,[m
[31m-  NONE: 0,[m
[31m-  FREETEXT: 3,[m
[31m-  HIGHLIGHT: 9,[m
[31m-  STAMP: 13,[m
[31m-  INK: 15,[m
[31m-  SIGNATURE: 101[m
[31m-};[m
[31m-const AnnotationEditorParamsType = {[m
[31m-  RESIZE: 1,[m
[31m-  CREATE: 2,[m
[31m-  FREETEXT_SIZE: 11,[m
[31m-  FREETEXT_COLOR: 12,[m
[31m-  FREETEXT_OPACITY: 13,[m
[31m-  INK_COLOR: 21,[m
[31m-  INK_THICKNESS: 22,[m
[31m-  INK_OPACITY: 23,[m
[31m-  HIGHLIGHT_COLOR: 31,[m
[31m-  HIGHLIGHT_DEFAULT_COLOR: 32,[m
[31m-  HIGHLIGHT_THICKNESS: 33,[m
[31m-  HIGHLIGHT_FREE: 34,[m
[31m-  HIGHLIGHT_SHOW_ALL: 35,[m
[31m-  DRAW_STEP: 41[m
[31m-};[m
[31m-const PermissionFlag = {[m
[31m-  PRINT: 0x04,[m
[31m-  MODIFY_CONTENTS: 0x08,[m
[31m-  COPY: 0x10,[m
[31m-  MODIFY_ANNOTATIONS: 0x20,[m
[31m-  FILL_INTERACTIVE_FORMS: 0x100,[m
[31m-  COPY_FOR_ACCESSIBILITY: 0x200,[m
[31m-  ASSEMBLE: 0x400,[m
[31m-  PRINT_HIGH_QUALITY: 0x800[m
[31m-};[m
[31m-const TextRenderingMode = {[m
[31m-  FILL: 0,[m
[31m-  STROKE: 1,[m
[31m-  FILL_STROKE: 2,[m
[31m-  INVISIBLE: 3,[m
[31m-  FILL_ADD_TO_PATH: 4,[m
[31m-  STROKE_ADD_TO_PATH: 5,[m
[31m-  FILL_STROKE_ADD_TO_PATH: 6,[m
[31m-  ADD_TO_PATH: 7,[m
[31m-  FILL_STROKE_MASK: 3,[m
[31m-  ADD_TO_PATH_FLAG: 4[m
[31m-};[m
[31m-const util_ImageKind = {[m
[31m-  GRAYSCALE_1BPP: 1,[m
[31m-  RGB_24BPP: 2,[m
[31m-  RGBA_32BPP: 3[m
[31m-};[m
[31m-const AnnotationType = {[m
[31m-  TEXT: 1,[m
[31m-  LINK: 2,[m
[31m-  FREETEXT: 3,[m
[31m-  LINE: 4,[m
[31m-  SQUARE: 5,[m
[31m-  CIRCLE: 6,[m
[31m-  POLYGON: 7,[m
[31m-  POLYLINE: 8,[m
[31m-  HIGHLIGHT: 9,[m
[31m-  UNDERLINE: 10,[m
[31m-  SQUIGGLY: 11,[m
[31m-  STRIKEOUT: 12,[m
[31m-  STAMP: 13,[m
[31m-  CARET: 14,[m
[31m-  INK: 15,[m
[31m-  POPUP: 16,[m
[31m-  FILEATTACHMENT: 17,[m
[31m-  SOUND: 18,[m
[31m-  MOVIE: 19,[m
[31m-  WIDGET: 20,[m
[31m-  SCREEN: 21,[m
[31m-  PRINTERMARK: 22,[m
[31m-  TRAPNET: 23,[m
[31m-  WATERMARK: 24,[m
[31m-  THREED: 25,[m
[31m-  REDACT: 26[m
[31m-};[m
[31m-const AnnotationReplyType = {[m
[31m-  GROUP: "Group",[m
[31m-  REPLY: "R"[m
[31m-};[m
[31m-const AnnotationFlag = {[m
[31m-  INVISIBLE: 0x01,[m
[31m-  HIDDEN: 0x02,[m
[31m-  PRINT: 0x04,[m
[31m-  NOZOOM: 0x08,[m
[31m-  NOROTATE: 0x10,[m
[31m-  NOVIEW: 0x20,[m
[31m-  READONLY: 0x40,[m
[31m-  LOCKED: 0x80,[m
[31m-  TOGGLENOVIEW: 0x100,[m
[31m-  LOCKEDCONTENTS: 0x200[m
[31m-};[m
[31m-const AnnotationFieldFlag = {[m
[31m-  READONLY: 0x0000001,[m
[31m-  REQUIRED: 0x0000002,[m
[31m-  NOEXPORT: 0x0000004,[m
[31m-  MULTILINE: 0x0001000,[m
[31m-  PASSWORD: 0x0002000,[m
[31m-  NOTOGGLETOOFF: 0x0004000,[m
[31m-  RADIO: 0x0008000,[m
[31m-  PUSHBUTTON: 0x0010000,[m
[31m-  COMBO: 0x0020000,[m
[31m-  EDIT: 0x0040000,[m
[31m-  SORT: 0x0080000,[m
[31m-  FILESELECT: 0x0100000,[m
[31m-  MULTISELECT: 0x0200000,[m
[31m-  DONOTSPELLCHECK: 0x0400000,[m
[31m-  DONOTSCROLL: 0x0800000,[m
[31m-  COMB: 0x1000000,[m
[31m-  RICHTEXT: 0x2000000,[m
[31m-  RADIOSINUNISON: 0x2000000,[m
[31m-  COMMITONSELCHANGE: 0x4000000[m
[31m-};[m
[31m-const AnnotationBorderStyleType = {[m
[31m-  SOLID: 1,[m
[31m-  DASHED: 2,[m
[31m-  BEVELED: 3,[m
[31m-  INSET: 4,[m
[31m-  UNDERLINE: 5[m
[31m-};[m
[31m-const AnnotationActionEventType = {[m
[31m-  E: "Mouse Enter",[m
[31m-  X: "Mouse Exit",[m
[31m-  D: "Mouse Down",[m
[31m-  U: "Mouse Up",[m
[31m-  Fo: "Focus",[m
[31m-  Bl: "Blur",[m
[31m-  PO: "PageOpen",[m
[31m-  PC: "PageClose",[m
[31m-  PV: "PageVisible",[m
[31m-  PI: "PageInvisible",[m
[31m-  K: "Keystroke",[m
[31m-  F: "Format",[m
[31m-  V: "Validate",[m
[31m-  C: "Calculate"[m
[31m-};[m
[31m-const DocumentActionEventType = {[m
[31m-  WC: "WillClose",[m
[31m-  WS: "WillSave",[m
[31m-  DS: "DidSave",[m
[31m-  WP: "WillPrint",[m
[31m-  DP: "DidPrint"[m
[31m-};[m
[31m-const PageActionEventType = {[m
[31m-  O: "PageOpen",[m
[31m-  C: "PageClose"[m
[31m-};[m
[31m-const VerbosityLevel = {[m
[31m-  ERRORS: 0,[m
[31m-  WARNINGS: 1,[m
[31m-  INFOS: 5[m
[31m-};[m
[31m-const OPS = {[m
[31m-  dependency: 1,[m
[31m-  setLineWidth: 2,[m
[31m-  setLineCap: 3,[m
[31m-  setLineJoin: 4,[m
[31m-  setMiterLimit: 5,[m
[31m-  setDash: 6,[m
[31m-  setRenderingIntent: 7,[m
[31m-  setFlatness: 8,[m
[31m-  setGState: 9,[m
[31m-  save: 10,[m
[31m-  restore: 11,[m
[31m-  transform: 12,[m
[31m-  moveTo: 13,[m
[31m-  lineTo: 14,[m
[31m-  curveTo: 15,[m
[31m-  curveTo2: 16,[m
[31m-  curveTo3: 17,[m
[31m-  closePath: 18,[m
[31m-  rectangle: 19,[m
[31m-  stroke: 20,[m
[31m-  closeStroke: 21,[m
[31m-  fill: 22,[m
[31m-  eoFill: 23,[m
[31m-  fillStroke: 24,[m
[31m-  eoFillStroke: 25,[m
[31m-  closeFillStroke: 26,[m
[31m-  closeEOFillStroke: 27,[m
[31m-  endPath: 28,[m
[31m-  clip: 29,[m
[31m-  eoClip: 30,[m
[31m-  beginText: 31,[m
[31m-  endText: 32,[m
[31m-  setCharSpacing: 33,[m
[31m-  setWordSpacing: 34,[m
[31m-  setHScale: 35,[m
[31m-  setLeading: 36,[m
[31m-  setFont: 37,[m
[31m-  setTextRenderingMode: 38,[m
[31m-  setTextRise: 39,[m
[31m-  moveText: 40,[m
[31m-  setLeadingMoveText: 41,[m
[31m-  setTextMatrix: 42,[m
[31m-  nextLine: 43,[m
[31m-  showText: 44,[m
[31m-  showSpacedText: 45,[m
[31m-  nextLineShowText: 46,[m
[31m-  nextLineSetSpacingShowText: 47,[m
[31m-  setCharWidth: 48,[m
[31m-  setCharWidthAndBounds: 49,[m
[31m-  setStrokeColorSpace: 50,[m
[31m-  setFillColorSpace: 51,[m
[31m-  setStrokeColor: 52,[m
[31m-  setStrokeColorN: 53,[m
[31m-  setFillColor: 54,[m
[31m-  setFillColorN: 55,[m
[31m-  setStrokeGray: 56,[m
[31m-  setFillGray: 57,[m
[31m-  setStrokeRGBColor: 58,[m
[31m-  setFillRGBColor: 59,[m
[31m-  setStrokeCMYKColor: 60,[m
[31m-  setFillCMYKColor: 61,[m
[31m-  shadingFill: 62,[m
[31m-  beginInlineImage: 63,[m
[31m-  beginImageData: 64,[m
[31m-  endInlineImage: 65,[m
[31m-  paintXObject: 66,[m
[31m-  markPoint: 67,[m
[31m-  markPointProps: 68,[m
[31m-  beginMarkedContent: 69,[m
[31m-  beginMarkedContentProps: 70,[m
[31m-  endMarkedContent: 71,[m
[31m-  beginCompat: 72,[m
[31m-  endCompat: 73,[m
[31m-  paintFormXObjectBegin: 74,[m
[31m-  paintFormXObjectEnd: 75,[m
[31m-  beginGroup: 76,[m
[31m-  endGroup: 77,[m
[31m-  beginAnnotation: 80,[m
[31m-  endAnnotation: 81,[m
[31m-  paintImageMaskXObject: 83,[m
[31m-  paintImageMaskXObjectGroup: 84,[m
[31m-  paintImageXObject: 85,[m
[31m-  paintInlineImageXObject: 86,[m
[31m-  paintInlineImageXObjectGroup: 87,[m
[31m-  paintImageXObjectRepeat: 88,[m
[31m-  paintImageMaskXObjectRepeat: 89,[m
[31m-  paintSolidColorImageMask: 90,[m
[31m-  constructPath: 91,[m
[31m-  setStrokeTransparent: 92,[m
[31m-  setFillTransparent: 93,[m
[31m-  rawFillPath: 94[m
[31m-};[m
[31m-const DrawOPS = {[m
[31m-  moveTo: 0,[m
[31m-  lineTo: 1,[m
[31m-  curveTo: 2,[m
[31m-  closePath: 3[m
[31m-};[m
[31m-const PasswordResponses = {[m
[31m-  NEED_PASSWORD: 1,[m
[31m-  INCORRECT_PASSWORD: 2[m
[31m-};[m
[31m-let verbosity = VerbosityLevel.WARNINGS;[m
[31m-function setVerbosityLevel(level) {[m
[31m-  if (Number.isInteger(level)) {[m
[31m-    verbosity = level;[m
[31m-  }[m
[31m-}[m
[31m-function getVerbosityLevel() {[m
[31m-  return verbosity;[m
[31m-}[m
[31m-function info(msg) {[m
[31m-  if (verbosity >= VerbosityLevel.INFOS) {[m
[31m-    console.log(`Info: ${msg}`);[m
[31m-  }[m
[31m-}[m
[31m-function warn(msg) {[m
[31m-  if (verbosity >= VerbosityLevel.WARNINGS) {[m
[31m-    console.log(`Warning: ${msg}`);[m
[31m-  }[m
[31m-}[m
[31m-function unreachable(msg) {[m
[31m-  throw new Error(msg);[m
[31m-}[m
[31m-function assert(cond, msg) {[m
[31m-  if (!cond) {[m
[31m-    unreachable(msg);[m
[31m-  }[m
[31m-}[m
[31m-function _isValidProtocol(url) {[m
[31m-  switch (url?.protocol) {[m
[31m-    case "http:":[m
[31m-    case "https:":[m
[31m-    case "ftp:":[m
[31m-    case "mailto:":[m
[31m-    case "tel:":[m
[31m-      return true;[m
[31m-    default:[m
[31m-      return false;[m
[31m-  }[m
[31m-}[m
[31m-function createValidAbsoluteUrl(url, baseUrl = null, options = null) {[m
[31m-  if (!url) {[m
[31m-    return null;[m
[31m-  }[m
[31m-  if (options && typeof url === "string") {[m
[31m-    if (options.addDefaultProtocol && url.startsWith("www.")) {[m
[31m-      const dots = url.match(/\./g);[m
[31m-      if (dots?.length >= 2) {[m
[31m-        url = `http://${url}`;[m
[31m-      }[m
[31m-    }[m
[31m-    if (options.tryConvertEncoding) {[m
[31m-      try {[m
[31m-        url = stringToUTF8String(url);[m
[31m-      } catch {}[m
[31m-    }[m
[31m-  }[m
[31m-  const absoluteUrl = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);[m
[31m-  return _isValidProtocol(absoluteUrl) ? absoluteUrl : null;[m
[31m-}[m
[31m-function updateUrlHash(url, hash, allowRel = false) {[m
[31m-  const res = URL.parse(url);[m
[31m-  if (res) {[m
[31m-    res.hash = hash;[m
[31m-    return res.href;[m
[31m-  }[m
[31m-  if (allowRel && createValidAbsoluteUrl(url, "http://example.com")) {[m
[31m-    return url.split("#", 1)[0] + `${hash ? `#${hash}` : ""}`;[m
[31m-  }[m
[31m-  return "";[m
[31m-}[m
[31m-function shadow(obj, prop, value, nonSerializable = false) {[m
[31m-  Object.defineProperty(obj, prop, {[m
[31m-    value,[m
[31m-    enumerable: !nonSerializable,[m
[31m-    configurable: true,[m
[31m-    writable: false[m
[31m-  });[m
[31m-  return value;[m
[31m-}[m
[31m-const BaseException = function BaseExceptionClosure() {[m
[31m-  function BaseException(message, name) {[m
[31m-    this.message = message;[m
[31m-    this.name = name;[m
[31m-  }[m
[31m-  BaseException.prototype = new Error();[m
[31m-  BaseException.constructor = BaseException;[m
[31m-  return BaseException;[m
[31m-}();[m
[31m-class PasswordException extends BaseException {[m
[31m-  constructor(msg, code) {[m
[31m-    super(msg, "PasswordException");[m
[31m-    this.code = code;[m
[31m-  }[m
[31m-}[m
[31m-class UnknownErrorException extends BaseException {[m
[31m-  constructor(msg, details) {[m
[31m-    super(msg, "UnknownErrorException");[m
[31m-    this.details = details;[m
[31m-  }[m
[31m-}[m
[31m-class InvalidPDFException extends BaseException {[m
[31m-  constructor(msg) {[m
[31m-    super(msg, "InvalidPDFException");[m
[31m-  }[m
[31m-}[m
[31m-class ResponseException extends BaseException {[m
[31m-  constructor(msg, status, missing) {[m
[31m-    super(msg, "ResponseException");[m
[31m-    this.status = status;[m
[31m-    this.missing = missing;[m
[31m-  }[m
[31m-}[m
[31m-class FormatError extends BaseException {[m
[31m-  constructor(msg) {[m
[31m-    super(msg, "FormatError");[m
[31m-  }[m
[31m-}[m
[31m-class AbortException extends BaseException {[m
[31m-  constructor(msg) {[m
[31m-    super(msg, "AbortException");[m
[31m-  }[m
[31m-}[m
[31m-function bytesToString(bytes) {[m
[31m-  if (typeof bytes !== "object" || bytes?.length === undefined) {[m
[31m-    unreachable("Invalid argument for bytesToString");[m
[31m-  }[m
[31m-  const length = bytes.length;[m
[31m-  const MAX_ARGUMENT_COUNT = 8192;[m
[31m-  if (length < MAX_ARGUMENT_COUNT) {[m
[31m-    return String.fromCharCode.apply(null, bytes);[m
[31m-  }[m
[31m-  const strBuf = [];[m
[31m-  for (let i = 0; i < length; i += MAX_ARGUMENT_COUNT) {[m
[31m-    const chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);[m
[31m-    const chunk = bytes.subarray(i, chunkEnd);[m
[31m-    strBuf.push(String.fromCharCode.apply(null, chunk));[m
[31m-  }[m
[31m-  return strBuf.join("");[m
[31m-}[m
[31m-function stringToBytes(str) {[m
[31m-  if (typeof str !== "string") {[m
[31m-    unreachable("Invalid argument for stringToBytes");[m
[31m-  }[m
[31m-  const length = str.length;[m
[31m-  const bytes = new Uint8Array(length);[m
[31m-  for (let i = 0; i < length; ++i) {[m
[31m-    bytes[i] = str.charCodeAt(i) & 0xff;[m
[31m-  }[m
[31m-  return bytes;[m
[31m-}[m
[31m-function string32(value) {[m
[31m-  return String.fromCharCode(value >> 24 & 0xff, value >> 16 & 0xff, value >> 8 & 0xff, value & 0xff);[m
[31m-}[m
[31m-function objectSize(obj) {[m
[31m-  return Object.keys(obj).length;[m
[31m-}[m
[31m-function isLittleEndian() {[m
[31m-  const buffer8 = new Uint8Array(4);[m
[31m-  buffer8[0] = 1;[m
[31m-  const view32 = new Uint32Array(buffer8.buffer, 0, 1);[m
[31m-  return view32[0] === 1;[m
[31m-}[m
[31m-function isEvalSupported() {[m
[31m-  try {[m
[31m-    new Function("");[m
[31m-    return true;[m
[31m-  } catch {[m
[31m-    return false;[m
[31m-  }[m
[31m-}[m
[31m-class util_FeatureTest {[m
[31m-  static get isLittleEndian() {[m
[31m-    return shadow(this, "isLittleEndian", isLittleEndian());[m
[31m-  }[m
[31m-  static get isEvalSupported() {[m
[31m-    return shadow(this, "isEvalSupported", isEvalSupported());[m
[31m-  }[m
[31m-  static get isOffscreenCanvasSupported() {[m
[31m-    return shadow(this, "isOffscreenCanvasSupported", typeof OffscreenCanvas !== "undefined");[m
[31m-  }[m
[31m-  static get isImageDecoderSupported() {[m
[31m-    return shadow(this, "isImageDecoderSupported", typeof ImageDecoder !== "undefined");[m
[31m-  }[m
[31m-  static get platform() {[m
[31m-    const {[m
[31m-      platform,[m
[31m-      userAgent[m
[31m-    } = navigator;[m
[31m-    return shadow(this, "platform", {[m
[31m-      isAndroid: userAgent.includes("Android"),[m
[31m-      isLinux: platform.includes("Linux"),[m
[31m-      isMac: platform.includes("Mac"),[m
[31m-      isWindows: platform.includes("Win"),[m
[31m-      isFirefox: userAgent.includes("Firefox")[m
[31m-    });[m
[31m-  }[m
[31m-  static get isCSSRoundSupported() {[m
[31m-    return shadow(this, "isCSSRoundSupported", globalThis.CSS?.supports?.("width: round(1.5px, 1px)"));[m
[31m-  }[m
[31m-}[m
[31m-const hexNumbers = Array.from(Array(256).keys(), n => n.toString(16).padStart(2, "0"));[m
[31m-class Util {[m
[31m-  static makeHexColor(r, g, b) {[m
[31m-    return `#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`;[m
[31m-  }[m
[31m-  static scaleMinMax(transform, minMax) {[m
[31m-    let temp;[m
[31m-    if (transform[0]) {[m
[31m-      if (transform[0] < 0) {[m
[31m-        temp = minMax[0];[m
[31m-        minMax[0] = minMax[2];[m
[31m-        minMax[2] = temp;[m
[31m-      }[m
[31m-      minMax[0] *= transform[0];[m
[31m-      minMax[2] *= transform[0];[m
[31m-      if (transform[3] < 0) {[m
[31m-        temp = minMax[1];[m
[31m-        minMax[1] = minMax[3];[m
[31m-        minMax[3] = temp;[m
[31m-      }[m
[31m-      minMax[1] *= transform[3];[m
[31m-      minMax[3] *= transform[3];[m
[31m-    } else {[m
[31m-      temp = minMax[0];[m
[31m-      minMax[0] = minMax[1];[m
[31m-      minMax[1] = temp;[m
[31m-      temp = minMax[2];[m
[31m-      minMax[2] = minMax[3];[m
[31m-      minMax[3] = temp;[m
[31m-      if (transform[1] < 0) {[m
[31m-        temp = minMax[1];[m
[31m-        minMax[1] = minMax[3];[m
[31m-        minMax[3] = temp;[m
[31m-      }[m
[31m-      minMax[1] *= transform[1];[m
[31m-      minMax[3] *= transform[1];[m
[31m-      if (transform[2] < 0) {[m
[31m-        temp = minMax[0];[m
[31m-        minMax[0] = minMax[2];[m
[31m-        minMax[2] = temp;[m
[31m-      }[m
[31m-      minMax[0] *= transform[2];[m
[31m-      minMax[2] *= transform[2];[m
[31m-    }[m
[31m-    minMax[0] += transform[4];[m
[31m-    minMax[1] += transform[5];[m
[31m-    minMax[2] += transform[4];[m
[31m-    minMax[3] += transform[5];[m
[31m-  }[m
[31m-  static transform(m1, m2) {[m
[31m-    return [m1[0] * m2[0] + m1[2] * m2[1], m1[1] * m2[0] + m1[3] * m2[1], m1[0] * m2[2] + m1[2] * m2[3], m1[1] * m2[2] + m1[3] * m2[3], m1[0] * m2[4] + m1[2] * m2[5] + m1[4], m1[1] * m2[4] + m1[3] * m2[5] + m1[5]];[m
[31m-  }[m
[31m-  static applyTransform(p, m, pos = 0) {[m
[31m-    const p0 = p[pos];[m
[31m-    const p1 = p[pos + 1];[m
[31m-    p[pos] = p0 * m[0] + p1 * m[2] + m[4];[m
[31m-    p[pos + 1] = p0 * m[1] + p1 * m[3] + m[5];[m
[31m-  }[m
[31m-  static applyTransformToBezier(p, transform, pos = 0) {[m
[31m-    const m0 = transform[0];[m
[31m-    const m1 = transform[1];[m
[31m-    const m2 = transform[2];[m
[31m-    const m3 = transform[3];[m
[31m-    const m4 = transform[4];[m
[31m-    const m5 = transform[5];[m
[31m-    for (let i = 0; i < 6; i += 2) {[m
[31m-      const pI = p[pos + i];[m
[31m-      const pI1 = p[pos + i + 1];[m
[31m-      p[pos + i] = pI * m0 + pI1 * m2 + m4;[m
[31m-      p[pos + i + 1] = pI * m1 + pI1 * m3 + m5;[m
[31m-    }[m
[31m-  }[m
[31m-  static applyInverseTransform(p, m) {[m
[31m-    const p0 = p[0];[m
[31m-    const p1 = p[1];[m
[31m-    const d = m[0] * m[3] - m[1] * m[2];[m
[31m-    p[0] = (p0 * m[3] - p1 * m[2] + m[2] * m[5] - m[4] * m[3]) / d;[m
[31m-    p[1] = (-p0 * m[1] + p1 * m[0] + m[4] * m[1] - m[5] * m[0]) / d;[m
[31m-  }[m
[31m-  static axialAlignedBoundingBox(rect, transform, output) {[m
[31m-    const m0 = transform[0];[m
[31m-    const m1 = transform[1];[m
[31m-    const m2 = transform[2];[m
[31m-    const m3 = transform[3];[m
[31m-    const m4 = transform[4];[m
[31m-    const m5 = transform[5];[m
[31m-    const r0 = rect[0];[m
[31m-    const r1 = rect[1];[m
[31m-    const r2 = rect[2];[m
[31m-    const r3 = rect[3];[m
[31m-    let a0 = m0 * r0 + m4;[m
[31m-    let a2 = a0;[m
[31m-    let a1 = m0 * r2 + m4;[m
[31m-    let a3 = a1;[m
[31m-    let b0 = m3 * r1 + m5;[m
[31m-    let b2 = b0;[m
[31m-    let b1 = m3 * r3 + m5;[m
[31m-    let b3 = b1;[m
[31m-    if (m1 !== 0 || m2 !== 0) {[m
[31m-      const m1r0 = m1 * r0;[m
[31m-      const m1r2 = m1 * r2;[m
[31m-      const m2r1 = m2 * r1;[m
[31m-      const m2r3 = m2 * r3;[m
[31m-      a0 += m2r1;[m
[31m-      a3 += m2r1;[m
[31m-      a1 += m2r3;[m
[31m-      a2 += m2r3;[m
[31m-      b0 += m1r0;[m
[31m-      b3 += m1r0;[m
[31m-      b1 += m1r2;[m
[31m-      b2 += m1r2;[m
[31m-    }[m
[31m-    output[0] = Math.min(output[0], a0, a1, a2, a3);[m
[31m-    output[1] = Math.min(output[1], b0, b1, b2, b3);[m
[31m-    output[2] = Math.max(output[2], a0, a1, a2, a3);[m
[31m-    output[3] = Math.max(output[3], b0, b1, b2, b3);[m
[31m-  }[m
[31m-  static inverseTransform(m) {[m
[31m-    const d = m[0] * m[3] - m[1] * m[2];[m
[31m-    return [m[3] / d, -m[1] / d, -m[2] / d, m[0] / d, (m[2] * m[5] - m[4] * m[3]) / d, (m[4] * m[1] - m[5] * m[0]) / d];[m
[31m-  }[m
[31m-  static singularValueDecompose2dScale(matrix, output) {[m
[31m-    const m0 = matrix[0];[m
[31m-    const m1 = matrix[1];[m
[31m-    const m2 = matrix[2];[m
[31m-    const m3 = matrix[3];[m
[31m-    const a = m0 ** 2 + m1 ** 2;[m
[31m-    const b = m0 * m2 + m1 * m3;[m
[31m-    const c = m2 ** 2 + m3 ** 2;[m
[31m-    const first = (a + c) / 2;[m
[31m-    const second = Math.sqrt(first ** 2 - (a * c - b ** 2));[m
[31m-    output[0] = Math.sqrt(first + second || 1);[m
[31m-    output[1] = Math.sqrt(first - second || 1);[m
[31m-  }[m
[31m-  static normalizeRect(rect) {[m
[31m-    const r = rect.slice(0);[m
[31m-    if (rect[0] > rect[2]) {[m
[31m-      r[0] = rect[2];[m
[31m-      r[2] = rect[0];[m
[31m-    }[m
[31m-    if (rect[1] > rect[3]) {[m
[31m-      r[1] = rect[3];[m
[31m-      r[3] = rect[1];[m
[31m-    }[m
[31m-    return r;[m
[31m-  }[m
[31m-  static intersect(rect1, rect2) {[m
[31m-    const xLow = Math.max(Math.min(rect1[0], rect1[2]), Math.min(rect2[0], rect2[2]));[m
[31m-    const xHigh = Math.min(Math.max(rect1[0], rect1[2]), Math.max(rect2[0], rect2[2]));[m
[31m-    if (xLow > xHigh) {[m
[31m-      return null;[m
[31m-    }[m
[31m-    const yLow = Math.max(Math.min(rect1[1], rect1[3]), Math.min(rect2[1], rect2[3]));[m
[31m-    const yHigh = Math.min(Math.max(rect1[1], rect1[3]), Math.max(rect2[1], rect2[3]));[m
[31m-    if (yLow > yHigh) {[m
[31m-      return null;[m
[31m-    }[m
[31m-    return [xLow, yLow, xHigh, yHigh];[m
[31m-  }[m
[31m-  static pointBoundingBox(x, y, minMax) {[m
[31m-    minMax[0] = Math.min(minMax[0], x);[m
[31m-    minMax[1] = Math.min(minMax[1], y);[m
[31m-    minMax[2] = Math.max(minMax[2], x);[m
[31m-    minMax[3] = Math.max(minMax[3], y);[m
[31m-  }[m
[31m-  static rectBoundingBox(x0, y0, x1, y1, minMax) {[m
[31m-    minMax[0] = Math.min(minMax[0], x0, x1);[m
[31m-    minMax[1] = Math.min(minMax[1], y0, y1);[m
[31m-    minMax[2] = Math.max(minMax[2], x0, x1);[m
[31m-    minMax[3] = Math.max(minMax[3], y0, y1);[m
[31m-  }[m
[31m-  static #getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, t, minMax) {[m
[31m-    if (t <= 0 || t >= 1) {[m
[31m-      return;[m
[31m-    }[m
[31m-    const mt = 1 - t;[m
[31m-    const tt = t * t;[m
[31m-    const ttt = tt * t;[m
[31m-    const x = mt * (mt * (mt * x0 + 3 * t * x1) + 3 * tt * x2) + ttt * x3;[m
[31m-    const y = mt * (mt * (mt * y0 + 3 * t * y1) + 3 * tt * y2) + ttt * y3;[m
[31m-    minMax[0] = Math.min(minMax[0], x);[m
[31m-    minMax[1] = Math.min(minMax[1], y);[m
[31m-    minMax[2] = Math.max(minMax[2], x);[m
[31m-    minMax[3] = Math.max(minMax[3], y);[m
[31m-  }[m
[31m-  static #getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, a, b, c, minMax) {[m
[31m-    if (Math.abs(a) < 1e-12) {[m
[31m-      if (Math.abs(b) >= 1e-12) {[m
[31m-        this.#getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, -c / b, minMax);[m
[31m-      }[m
[31m-      return;[m
[31m-    }[m
[31m-    const delta = b ** 2 - 4 * c * a;[m
[31m-    if (delta < 0) {[m
[31m-      return;[m
[31m-    }[m
[31m-    const sqrtDelta = Math.sqrt(delta);[m
[31m-    const a2 = 2 * a;[m
[31m-    this.#getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, (-b + sqrtDelta) / a2, minMax);[m
[31m-    this.#getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, (-b - sqrtDelta) / a2, minMax);[m
[31m-  }[m
[31m-  static bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3, minMax) {[m
[31m-    minMax[0] = Math.min(minMax[0], x0, x3);[m
[31m-    minMax[1] = Math.min(minMax[1], y0, y3);[m
[31m-    minMax[2] = Math.max(minMax[2], x0, x3);[m
[31m-    minMax[3] = Math.max(minMax[3], y0, y3);[m
[31m-    this.#getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, 3 * (-x0 + 3 * (x1 - x2) + x3), 6 * (x0 - 2 * x1 + x2), 3 * (x1 - x0), minMax);[m
[31m-    this.#getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, 3 * (-y0 + 3 * (y1 - y2) + y3), 6 * (y0 - 2 * y1 + y2), 3 * (y1 - y0), minMax);[m
[31m-  }[m
[31m-}[m
[31m-const PDFStringTranslateTable = (/* unused pure expression or super */ null && ([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2d8, 0x2c7, 0x2c6, 0x2d9, 0x2dd, 0x2db, 0x2da, 0x2dc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014, 0x2013, 0x192, 0x2044, 0x2039, 0x203a, 0x2212, 0x2030, 0x201e, 0x201c, 0x201d, 0x2018, 0x2019, 0x201a, 0x2122, 0xfb01, 0xfb02, 0x141, 0x152, 0x160, 0x178, 0x17d, 0x131, 0x142, 0x153, 0x161, 0x17e, 0, 0x20ac]));[m
[31m-function stringToPDFString(str, keepEscapeSequence = false) {[m
[31m-  if (str[0] >= "\xEF") {[m
[31m-    let encoding;[m
[31m-    if (str[0] === "\xFE" && str[1] === "\xFF") {[m
[31m-      encoding = "utf-16be";[m
[31m-      if (str.length % 2 === 1) {[m
[31m-        str = str.slice(0, -1);[m
[31m-      }[m
[31m-    } else if (str[0] === "\xFF" && str[1] === "\xFE") {[m
[31m-      encoding = "utf-16le";[m
[31m-      if (str.length % 2 === 1) {[m
[31m-        str = str.slice(0, -1);[m
[31m-      }[m
[31m-    } else if (str[0] === "\xEF" && str[1] === "\xBB" && str[2] === "\xBF") {[m
[31m-      encoding = "utf-8";[m
[31m-    }[m
[31m-    if (encoding) {[m
[31m-      try {[m
[31m-        const decoder = new TextDecoder(encoding, {[m
[31m-          fatal: true[m
[31m-        });[m
[31m-        const buffer = stringToBytes(str);[m
[31m-        const decoded = decoder.decode(buffer);[m
[31m-        if (keepEscapeSequence || !decoded.includes("\x1b")) {[m
[31m-          return decoded;[m
[31m-        }[m
[31m-        return decoded.replaceAll(/\x1b[^\x1b]*(?:\x1b|$)/g, "");[m
[31m-      } catch (ex) {[m
[31m-        warn(`stringToPDFString: "${ex}".`);[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-  const strBuf = [];[m
[31m-  for (let i = 0, ii = str.length; i < ii; i++) {[m
[31m-    const charCode = str.charCodeAt(i);[m
[31m-    if (!keepEscapeSequence && charCode === 0x1b) {[m
[31m-      while (++i < ii && str.charCodeAt(i) !== 0x1b) {}[m
[31m-      continue;[m
[31m-    }[m
[31m-    const code = PDFStringTranslateTable[charCode];[m
[31m-    strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));[m
[31m-  }[m
[31m-  return strBuf.join("");[m
[31m-}[m
[31m-function stringToUTF8String(str) {[m
[31m-  return decodeURIComponent(escape(str));[m
[31m-}[m
[31m-function utf8StringToString(str) {[m
[31m-  return unescape(encodeURIComponent(str));[m
[31m-}[m
[31m-function isArrayEqual(arr1, arr2) {[m
[31m-  if (arr1.length !== arr2.length) {[m
[31m-    return false;[m
[31m-  }[m
[31m-  for (let i = 0, ii = arr1.length; i < ii; i++) {[m
[31m-    if (arr1[i] !== arr2[i]) {[m
[31m-      return false;[m
[31m-    }[m
[31m-  }[m
[31m-  return true;[m
[31m-}[m
[31m-function getModificationDate(date = new Date()) {[m
[31m-  const buffer = [date.getUTCFullYear().toString(), (date.getUTCMonth() + 1).toString().padStart(2, "0"), date.getUTCDate().toString().padStart(2, "0"), date.getUTCHours().toString().padStart(2, "0"), date.getUTCMinutes().toString().padStart(2, "0"), date.getUTCSeconds().toString().padStart(2, "0")];[m
[31m-  return buffer.join("");[m
[31m-}[m
[31m-let NormalizeRegex = null;[m
[31m-let NormalizationMap = null;[m
[31m-function normalizeUnicode(str) {[m
[31m-  if (!NormalizeRegex) {[m
[31m-    NormalizeRegex = /([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu;[m
[31m-    NormalizationMap = new Map([["ï¬…", "Å¿t"]]);[m
[31m-  }[m
[31m-  return str.replaceAll(NormalizeRegex, (_, p1, p2) => p1 ? p1.normalize("NFKC") : NormalizationMap.get(p2));[m
[31m-}[m
[31m-function getUuid() {[m
[31m-  if (typeof crypto.randomUUID === "function") {[m
[31m-    return crypto.randomUUID();[m
[31m-  }[m
[31m-  const buf = new Uint8Array(32);[m
[31m-  crypto.getRandomValues(buf);[m
[31m-  return bytesToString(buf);[m
[31m-}[m
[31m-const AnnotationPrefix = "pdfjs_internal_id_";[m
[31m-function _isValidExplicitDest(validRef, validName, dest) {[m
[31m-  if (!Array.isArray(dest) || dest.length < 2) {[m
[31m-    return false;[m
[31m-  }[m
[31m-  const [page, zoom, ...args] = dest;[m
[31m-  if (!validRef(page) && !Number.isInteger(page)) {[m
[31m-    return false;[m
[31m-  }[m
[31m-  if (!validName(zoom)) {[m
[31m-    return false;[m
[31m-  }[m
[31m-  const argsLen = args.length;[m
[31m-  let allowNull = true;[m
[31m-  switch (zoom.name) {[m
[31m-    case "XYZ":[m
[31m-      if (argsLen < 2 || argsLen > 3) {[m
[31m-        return false;[m
[31m-      }[m
[31m-      break;[m
[31m-    case "Fit":[m
[31m-    case "FitB":[m
[31m-      return argsLen === 0;[m
[31m-    case "FitH":[m
[31m-    case "FitBH":[m
[31m-    case "FitV":[m
[31m-    case "FitBV":[m
[31m-      if (argsLen > 1) {[m
[31m-        return false;[m
[31m-      }[m
[31m-      break;[m
[31m-    case "FitR":[m
[31m-      if (argsLen !== 4) {[m
[31m-        return false;[m
[31m-      }[m
[31m-      allowNull = false;[m
[31m-      break;[m
[31m-    default:[m
[31m-      return false;[m
[31m-  }[m
[31m-  for (const arg of args) {[m
[31m-    if (typeof arg === "number" || allowNull && arg === null) {[m
[31m-      continue;[m
[31m-    }[m
[31m-    return false;[m
[31m-  }[m
[31m-  return true;[m
[31m-}[m
[31m-function MathClamp(v, min, max) {[m
[31m-  return Math.min(Math.max(v, min), max);[m
[31m-}[m
[31m-function toHexUtil(arr) {[m
[31m-  if (Uint8Array.prototype.toHex) {[m
[31m-    return arr.toHex();[m
[31m-  }[m
[31m-  return Array.from(arr, num => hexNumbers[num]).join("");[m
[31m-}[m
[31m-function toBase64Util(arr) {[m
[31m-  if (Uint8Array.prototype.toBase64) {[m
[31m-    return arr.toBase64();[m
[31m-  }[m
[31m-  return btoa(bytesToString(arr));[m
[31m-}[m
[31m-function fromBase64Util(str) {[m
[31m-  if (Uint8Array.fromBase64) {[m
[31m-    return Uint8Array.fromBase64(str);[m
[31m-  }[m
[31m-  return stringToBytes(atob(str));[m
[31m-}[m
[31m-if (typeof Promise.try !== "function") {[m
[31m-  Promise.try = function (fn, ...args) {[m
[31m-    return new Promise(resolve => {[m
[31m-      resolve(fn(...args));[m
[31m-    });[m
[31m-  };[m
[31m-}[m
[31m-if (typeof Math.sumPrecise !== "function") {[m
[31m-  Math.sumPrecise = function (numbers) {[m
[31m-    return numbers.reduce((a, b) => a + b, 0);[m
[31m-  };[m
[31m-}[m
[31m-[m
[31m-;// ./src/display/display_utils.js[m
[31m-[m
[31m-const SVG_NS = "http://www.w3.org/2000/svg";[m
[31m-class PixelsPerInch {[m
[31m-  static CSS = 96.0;[m
[31m-  static PDF = 72.0;[m
[31m-  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;[m
[31m-}[m
[31m-async function fetchData(url, type = "text") {[m
[31m-  if (isValidFetchUrl(url, document.baseURI)) {[m
[31m-    const response = await fetch(url);[m
[31m-    if (!response.ok) {[m
[31m-      throw new Error(response.statusText);[m
[31m-    }[m
[31m-    switch (type) {[m
[31m-      case "arraybuffer":[m
[31m-        return response.arrayBuffer();[m
[31m-      case "blob":[m
[31m-        return response.blob();[m
[31m-      case "json":[m
[31m-        return response.json();[m
[31m-    }[m
[31m-    return response.text();[m
[31m-  }[m
[31m-  return new Promise((resolve, reject) => {[m
[31m-    const request = new XMLHttpRequest();[m
[31m-    request.open("GET", url, true);[m
[31m-    request.responseType = type;[m
[31m-    request.onreadystatechange = () => {[m
[31m-      if (request.readyState !== XMLHttpRequest.DONE) {[m
[31m-        return;[m
[31m-      }[m
[31m-      if (request.status === 200 || request.status === 0) {[m
[31m-        switch (type) {[m
[31m-          case "arraybuffer":[m
[31m-          case "blob":[m
[31m-          case "json":[m
[31m-            resolve(request.response);[m
[31m-            return;[m
[31m-        }[m
[31m-        resolve(request.responseText);[m
[31m-        return;[m
[31m-      }[m
[31m-      reject(new Error(request.statusText));[m
[31m-    };[m
[31m-    request.send(null);[m
[31m-  });[m
[31m-}[m
[31m-class PageViewport {[m
[31m-  constructor({[m
[31m-    viewBox,[m
[31m-    userUnit,[m
[31m-    scale,[m
[31m-    rotation,[m
[31m-    offsetX = 0,[m
[31m-    offsetY = 0,[m
[31m-    dontFlip = false[m
[31m-  }) {[m
[31m-    this.viewBox = viewBox;[m
[31m-    this.userUnit = userUnit;[m
[31m-    this.scale = scale;[m
[31m-    this.rotation = rotation;[m
[31m-    this.offsetX = offsetX;[m
[31m-    this.offsetY = offsetY;[m
[31m-    scale *= userUnit;[m
[31m-    const centerX = (viewBox[2] + viewBox[0]) / 2;[m
[31m-    const centerY = (viewBox[3] + viewBox[1]) / 2;[m
[31m-    let rotateA, rotateB, rotateC, rotateD;[m
[31m-    rotation %= 360;[m
[31m-    if (rotation < 0) {[m
[31m-      rotation += 360;[m
[31m-    }[m
[31m-    switch (rotation) {[m
[31m-      case 180:[m
[31m-        rotateA = -1;[m
[31m-        rotateB = 0;[m
[31m-        rotateC = 0;[m
[31m-        rotateD = 1;[m
[31m-        break;[m
[31m-      case 90:[m
[31m-        rotateA = 0;[m
[31m-        rotateB = 1;[m
[31m-        rotateC = 1;[m
[31m-        rotateD = 0;[m
[31m-        break;[m
[31m-      case 270:[m
[31m-        rotateA = 0;[m
[31m-        rotateB = -1;[m
[31m-        rotateC = -1;[m
[31m-        rotateD = 0;[m
[31m-        break;[m
[31m-      case 0:[m
[31m-        rotateA = 1;[m
[31m-        rotateB = 0;[m
[31m-        rotateC = 0;[m
[31m-        rotateD = -1;[m
[31m-        break;[m
[31m-      default:[m
[31m-        throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.");[m
[31m-    }[m
[31m-    if (dontFlip) {[m
[31m-      rotateC = -rotateC;[m
[31m-      rotateD = -rotateD;[m
[31m-    }[m
[31m-    let offsetCanvasX, offsetCanvasY;[m
[31m-    let width, height;[m
[31m-    if (rotateA === 0) {[m
[31m-      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;[m
[31m-      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;[m
[31m-      width = (viewBox[3] - viewBox[1]) * scale;[m
[31m-      height = (viewBox[2] - viewBox[0]) * scale;[m
[31m-    } else {[m
[31m-      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;[m
[31m-      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;[m
[31m-      width = (viewBox[2] - viewBox[0]) * scale;[m
[31m-      height = (viewBox[3] - viewBox[1]) * scale;[m
[31m-    }[m
[31m-    this.transform = [rotateA * scale, rotateB * scale, rotateC * scale, rotateD * scale, offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY, offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY];[m
[31m-    this.width = width;[m
[31m-    this.height = height;[m
[31m-  }[m
[31m-  get rawDims() {[m
[31m-    const dims = this.viewBox;[m
[31m-    return shadow(this, "rawDims", {[m
[31m-      pageWidth: dims[2] - dims[0],[m
[31m-      pageHeight: dims[3] - dims[1],[m
[31m-      pageX: dims[0],[m
[31m-      pageY: dims[1][m
[31m-    });[m
[31m-  }[m
[31m-  clone({[m
[31m-    scale = this.scale,[m
[31m-    rotation = this.rotation,[m
[31m-    offsetX = this.offsetX,[m
[31m-    offsetY = this.offsetY,[m
[31m-    dontFlip = false[m
[31m-  } = {}) {[m
[31m-    return new PageViewport({[m
[31m-      viewBox: this.viewBox.slice(),[m
[31m-      userUnit: this.userUnit,[m
[31m-      scale,[m
[31m-      rotation,[m
[31m-      offsetX,[m
[31m-      offsetY,[m
[31m-      dontFlip[m
[31m-    });[m
[31m-  }[m
[31m-  convertToViewportPoint(x, y) {[m
[31m-    const p = [x, y];[m
[31m-    Util.applyTransform(p, this.transform);[m
[31m-    return p;[m
[31m-  }[m
[31m-  convertToViewportRectangle(rect) {[m
[31m-    const topLeft = [rect[0], rect[1]];[m
[31m-    Util.applyTransform(topLeft, this.transform);[m
[31m-    const bottomRight = [rect[2], rect[3]];[m
[31m-    Util.applyTransform(bottomRight, this.transform);[m
[31m-    return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];[m
[31m-  }[m
[31m-  convertToPdfPoint(x, y) {[m
[31m-    const p = [x, y];[m
[31m-    Util.applyInverseTransform(p, this.transform);[m
[31m-    return p;[m
[31m-  }[m
[31m-}[m
[31m-class RenderingCancelledException extends BaseException {[m
[31m-  constructor(msg, extraDelay = 0) {[m
[31m-    super(msg, "RenderingCancelledException");[m
[31m-    this.extraDelay = extraDelay;[m
[31m-  }[m
[31m-}[m
[31m-function isDataScheme(url) {[m
[31m-  const ii = url.length;[m
[31m-  let i = 0;[m
[31m-  while (i < ii && url[i].trim() === "") {[m
[31m-    i++;[m
[31m-  }[m
[31m-  return url.substring(i, i + 5).toLowerCase() === "data:";[m
[31m-}[m
[31m-function isPdfFile(filename) {[m
[31m-  return typeof filename === "string" && /\.pdf$/i.test(filename);[m
[31m-}[m
[31m-function getFilenameFromUrl(url) {[m
[31m-  [url] = url.split(/[#?]/, 1);[m
[31m-  return url.substring(url.lastIndexOf("/") + 1);[m
[31m-}[m
[31m-function getPdfFilenameFromUrl(url, defaultFilename = "document.pdf") {[m
[31m-  if (typeof url !== "string") {[m
[31m-    return defaultFilename;[m
[31m-  }[m
[31m-  if (isDataScheme(url)) {[m
[31m-    warn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.');[m
[31m-    return defaultFilename;[m
[31m-  }[m
[31m-  const reURI = /^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/;[m
[31m-  const reFilename = /[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i;[m
[31m-  const splitURI = reURI.exec(url);[m
[31m-  let suggestedFilename = reFilename.exec(splitURI[1]) || reFilename.exec(splitURI[2]) || reFilename.exec(splitURI[3]);[m
[31m-  if (suggestedFilename) {[m
[31m-    suggestedFilename = suggestedFilename[0];[m
[31m-    if (suggestedFilename.includes("%")) {[m
[31m-      try {[m
[31m-        suggestedFilename = reFilename.exec(decodeURIComponent(suggestedFilename))[0];[m
[31m-      } catch {}[m
[31m-    }[m
[31m-  }[m
[31m-  return suggestedFilename || defaultFilename;[m
[31m-}[m
[31m-class StatTimer {[m
[31m-  started = Object.create(null);[m
[31m-  times = [];[m
[31m-  time(name) {[m
[31m-    if (name in this.started) {[m
[31m-      warn(`Timer is already running for ${name}`);[m
[31m-    }[m
[31m-    this.started[name] = Date.now();[m
[31m-  }[m
[31m-  timeEnd(name) {[m
[31m-    if (!(name in this.started)) {[m
[31m-      warn(`Timer has not been started for ${name}`);[m
[31m-    }[m
[31m-    this.times.push({[m
[31m-      name,[m
[31m-      start: this.started[name],[m
[31m-      end: Date.now()[m
[31m-    });[m
[31m-    delete this.started[name];[m
[31m-  }[m
[31m-  toString() {[m
[31m-    const outBuf = [];[m
[31m-    let longest = 0;[m
[31m-    for (const {[m
[31m-      name[m
[31m-    } of this.times) {[m
[31m-      longest = Math.max(name.length, longest);[m
[31m-    }[m
[31m-    for (const {[m
[31m-      name,[m
[31m-      start,[m
[31m-      end[m
[31m-    } of this.times) {[m
[31m-      outBuf.push(`${name.padEnd(longest)} ${end - start}ms\n`);[m
[31m-    }[m
[31m-    return outBuf.join("");[m
[31m-  }[m
[31m-}[m
[31m-function isValidFetchUrl(url, baseUrl) {[m
[31m-  const res = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);[m
[31m-  return res?.protocol === "http:" || res?.protocol === "https:";[m
[31m-}[m
[31m-function noContextMenu(e) {[m
[31m-  e.preventDefault();[m
[31m-}[m
[31m-function stopEvent(e) {[m
[31m-  e.preventDefault();[m
[31m-  e.stopPropagation();[m
[31m-}[m
[31m-function deprecated(details) {[m
[31m-  console.log("Deprecated API usage: " + details);[m
[31m-}[m
[31m-class PDFDateString {[m
[31m-  static #regex;[m
[31m-  static toDateObject(input) {[m
[31m-    if (!input || typeof input !== "string") {[m
[31m-      return null;[m
[31m-    }[m
[31m-    this.#regex ||= new RegExp("^D:" + "(\\d{4})" + "(\\d{2})?" + "(\\d{2})?" + "(\\d{2})?" + "(\\d{2})?" + "(\\d{2})?" + "([Z|+|-])?" + "(\\d{2})?" + "'?" + "(\\d{2})?" + "'?");[m
[31m-    const matches = this.#regex.exec(input);[m
[31m-    if (!matches) {[m
[31m-      return null;[m
[31m-    }[m
[31m-    const year = parseInt(matches[1], 10);[m
[31m-    let month = parseInt(matches[2], 10);[m
[31m-    month = month >= 1 && month <= 12 ? month - 1 : 0;[m
[31m-    let day = parseInt(matches[3], 10);[m
[31m-    day = day >= 1 && day <= 31 ? day : 1;[m
[31m-    let hour = parseInt(matches[4], 10);[m
[31m-    hour = hour >= 0 && hour <= 23 ? hour : 0;[m
[31m-    let minute = parseInt(matches[5], 10);[m
[31m-    minute = minute >= 0 && minute <= 59 ? minute : 0;[m
[31m-    let second = parseInt(matches[6], 10);[m
[31m-    second = second >= 0 && second <= 59 ? second : 0;[m
[31m-    const universalTimeRelation = matches[7] || "Z";[m
[31m-    let offsetHour = parseInt(matches[8], 10);[m
[31m-    offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;[m
[31m-    let offsetMinute = parseInt(matches[9], 10) || 0;[m
[31m-    offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;[m
[31m-    if (universalTimeRelation === "-") {[m
[31m-      hour += offsetHour;[m
[31m-      minute += offsetMinute;[m
[31m-    } else if (universalTimeRelation === "+") {[m
[31m-      hour -= offsetHour;[m
[31m-      minute -= offsetMinute;[m
[31m-    }[m
[31m-    return new Date(Date.UTC(year, month, day, hour, minute, second));[m
[31m-  }[m
[31m-}[m
[31m-function getXfaPageViewport(xfaPage, {[m
[31m-  scale = 1,[m
[31m-  rotation = 0[m
[31m-}) {[m
[31m-  const {[m
[31m-    width,[m
[31m-    height[m
[31m-  } = xfaPage.attributes.style;[m
[31m-  const viewBox = [0, 0, parseInt(width), parseInt(height)];[m
[31m-  return new PageViewport({[m
[31m-    viewBox,[m
[31m-    userUnit: 1,[m
[31m-    scale,[m
[31m-    rotation[m
[31m-  });[m
[31m-}[m
[31m-function getRGB(color) {[m
[31m-  if (color.startsWith("#")) {[m
[31m-    const colorRGB = parseInt(color.slice(1), 16);[m
[31m-    return [(colorRGB & 0xff0000) >> 16, (colorRGB & 0x00ff00) >> 8, colorRGB & 0x0000ff];[m
[31m-  }[m
[31m-  if (color.startsWith("rgb(")) {[m
[31m-    return color.slice(4, -1).split(",").map(x => parseInt(x));[m
[31m-  }[m
[31m-  if (color.startsWith("rgba(")) {[m
[31m-    return color.slice(5, -1).split(",").map(x => parseInt(x)).slice(0, 3);[m
[31m-  }[m
[31m-  warn(`Not a valid color format: "${color}"`);[m
[31m-  return [0, 0, 0];[m
[31m-}[m
[31m-function getColorValues(colors) {[m
[31m-  const span = document.createElement("span");[m
[31m-  span.style.visibility = "hidden";[m
[31m-  span.style.colorScheme = "only light";[m
[31m-  document.body.append(span);[m
[31m-  for (const name of colors.keys()) {[m
[31m-    span.style.color = name;[m
[31m-    const computedColor = window.getComputedStyle(span).color;[m
[31m-    colors.set(name, getRGB(computedColor));[m
[31m-  }[m
[31m-  span.remove();[m
[31m-}[m
[31m-function getCurrentTransform(ctx) {[m
[31m-  const {[m
[31m-    a,[m
[31m-    b,[m
[31m-    c,[m
[31m-    d,[m
[31m-    e,[m
[31m-    f[m
[31m-  } = ctx.getTransform();[m
[31m-  return [a, b, c, d, e, f];[m
[31m-}[m
[31m-function getCurrentTransformInverse(ctx) {[m
[31m-  const {[m
[31m-    a,[m
[31m-    b,[m
[31m-    c,[m
[31m-    d,[m
[31m-    e,[m
[31m-    f[m
[31m-  } = ctx.getTransform().invertSelf();[m
[31m-  return [a, b, c, d, e, f];[m
[31m-}[m
[31m-function setLayerDimensions(div, viewport, mustFlip = false, mustRotate = true) {[m
[31m-  if (viewport instanceof PageViewport) {[m
[31m-    const {[m
[31m-      pageWidth,[m
[31m-      pageHeight[m
[31m-    } = viewport.rawDims;[m
[31m-    const {[m
[31m-      style[m
[31m-    } = div;[m
[31m-    const useRound = util_FeatureTest.isCSSRoundSupported;[m
[31m-    const w = `var(--total-scale-factor) * ${pageWidth}px`,[m
[31m-      h = `var(--total-scale-factor) * ${pageHeight}px`;[m
[31m-    const widthStr = useRound ? `round(down, ${w}, var(--scale-round-x))` : `calc(${w})`,[m
[31m-      heightStr = useRound ? `round(down, ${h}, var(--scale-round-y))` : `calc(${h})`;[m
[31m-    if (!mustFlip || viewport.rotation % 180 === 0) {[m
[31m-      style.width = widthStr;[m
[31m-      style.height = heightStr;[m
[31m-    } else {[m
[31m-      style.width = heightStr;[m
[31m-      style.height = widthStr;[m
[31m-    }[m
[31m-  }[m
[31m-  if (mustRotate) {[m
[31m-    div.setAttribute("data-main-rotation", viewport.rotation);[m
[31m-  }[m
[31m-}[m
[31m-class OutputScale {[m
[31m-  constructor() {[m
[31m-    const {[m
[31m-      pixelRatio[m
[31m-    } = OutputScale;[m
[31m-    this.sx = pixelRatio;[m
[31m-    this.sy = pixelRatio;[m
[31m-  }[m
[31m-  get scaled() {[m
[31m-    return this.sx !== 1 || this.sy !== 1;[m
[31m-  }[m
[31m-  get symmetric() {[m
[31m-    return this.sx === this.sy;[m
[31m-  }[m
[31m-  limitCanvas(width, height, maxPixels, maxDim, capAreaFactor = -1) {[m
[31m-    let maxAreaScale = Infinity,[m
[31m-      maxWidthScale = Infinity,[m
[31m-      maxHeightScale = Infinity;[m
[31m-    maxPixels = OutputScale.capPixels(maxPixels, capAreaFactor);[m
[31m-    if (maxPixels > 0) {[m
[31m-      maxAreaScale = Math.sqrt(maxPixels / (width * height));[m
[31m-    }[m
[31m-    if (maxDim !== -1) {[m
[31m-      maxWidthScale = maxDim / width;[m
[31m-      maxHeightScale = maxDim / height;[m
[31m-    }[m
[31m-    const maxScale = Math.min(maxAreaScale, maxWidthScale, maxHeightScale);[m
[31m-    if (this.sx > maxScale || this.sy > maxScale) {[m
[31m-      this.sx = maxScale;[m
[31m-      this.sy = maxScale;[m
[31m-      return true;[m
[31m-    }[m
[31m-    return false;[m
[31m-  }[m
[31m-  static get pixelRatio() {[m
[31m-    return globalThis.devicePixelRatio || 1;[m
[31m-  }[m
[31m-  static capPixels(maxPixels, capAreaFactor) {[m
[31m-    if (capAreaFactor >= 0) {[m
[31m-      const winPixels = Math.ceil(window.screen.availWidth * window.screen.availHeight * this.pixelRatio ** 2 * (1 + capAreaFactor / 100));[m
[31m-      return maxPixels > 0 ? Math.min(maxPixels, winPixels) : winPixels;[m
[31m-    }[m
[31m-    return maxPixels;[m
[31m-  }[m
[31m-}[m
[31m-const SupportedImageMimeTypes = ["image/apng", "image/avif", "image/bmp", "image/gif", "image/jpeg", "image/png", "image/svg+xml", "image/webp", "image/x-icon"];[m
[31m-[m
[31m-;// ./src/display/editor/toolbar.js[m
[31m-[m
[31m-class EditorToolbar {[m
[31m-  #toolbar = null;[m
[31m-  #colorPicker = null;[m
[31m-  #editor;[m
[31m-  #buttons = null;[m
[31m-  #altText = null;[m
[31m-  #signatureDescriptionButton = null;[m
[31m-  static #l10nRemove = null;[m
[31m-  constructor(editor) {[m
[31m-    this.#editor = editor;[m
[31m-    EditorToolbar.#l10nRemove ||= Object.freeze({[m
[31m-      freetext: "pdfjs-editor-remove-freetext-button",[m
[31m-      highlight: "pdfjs-editor-remove-highlight-button",[m
[31m-      ink: "pdfjs-editor-remove-ink-button",[m
[31m-      stamp: "pdfjs-editor-remove-stamp-button",[m
[31m-      signature: "pdfjs-editor-remove-signature-button"[m
[31m-    });[m
[31m-  }[m
[31m-  render() {[m
[31m-    const editToolbar = this.#toolbar = document.createElement("div");[m
[31m-    editToolbar.classList.add("editToolbar", "hidden");[m
[31m-    editToolbar.setAttribute("role", "toolbar");[m
[31m-    const signal = this.#editor._uiManager._signal;[m
[31m-    editToolbar.addEventListener("contextmenu", noContextMenu, {[m
[31m-      signal[m
[31m-    });[m
[31m-    editToolbar.addEventListener("pointerdown", EditorToolbar.#pointerDown, {[m
[31m-      signal[m
[31m-    });[m
[31m-    const buttons = this.#buttons = document.createElement("div");[m
[31m-    buttons.className = "buttons";[m
[31m-    editToolbar.append(buttons);[m
[31m-    const position = this.#editor.toolbarPosition;[m
[31m-    if (position) {[m
[31m-      const {[m
[31m-        style[m
[31m-      } = editToolbar;[m
[31m-      const x = this.#editor._uiManager.direction === "ltr" ? 1 - position[0] : position[0];[m
[31m-      style.insetInlineEnd = `${100 * x}%`;[m
[31m-      style.top = `calc(${100 * position[1]}% + var(--editor-toolbar-vert-offset))`;[m
[31m-    }[m
[31m-    this.#addDeleteButton();[m
[31m-    return editToolbar;[m
[31m-  }[m
[31m-  get div() {[m
[31m-    return this.#toolbar;[m
[31m-  }[m
[31m-  static #pointerDown(e) {[m
[31m-    e.stopPropagation();[m
[31m-  }[m
[31m-  #focusIn(e) {[m
[31m-    this.#editor._focusEventsAllowed = false;[m
[31m-    stopEvent(e);[m
[31m-  }[m
[31m-  #focusOut(e) {[m
[31m-    this.#editor._focusEventsAllowed = true;[m
[31m-    stopEvent(e);[m
[31m-  }[m
[31m-  #addListenersToElement(element) {[m
[31m-    const signal = this.#editor._uiManager._signal;[m
[31m-    element.addEventListener("focusin", this.#focusIn.bind(this), {[m
[31m-      capture: true,[m
[31m-      signal[m
[31m-    });[m
[31m-    element.addEventListener("focusout", this.#focusOut.bind(this), {[m
[31m-      capture: true,[m
[31m-      signal[m
[31m-    });[m
[31m-    element.addEventListener("contextmenu", noContextMenu, {[m
[31m-      signal[m
[31m-    });[m
[31m-  }[m
[31m-  hide() {[m
[31m-    this.#toolbar.classList.add("hidden");[m
[31m-    this.#colorPicker?.hideDropdown();[m
[31m-  }[m
[31m-  show() {[m
[31m-    this.#toolbar.classList.remove("hidden");[m
[31m-    this.#altText?.shown();[m
[31m-  }[m
[31m-  #addDeleteButton() {[m
[31m-    const {[m
[31m-      editorType,[m
[31m-      _uiManager[m
[31m-    } = this.#editor;[m
[31m-    const button = document.createElement("button");[m
[31m-    button.className = "delete";[m
[31m-    button.tabIndex = 0;[m
[31m-    button.setAttribute("data-l10n-id", EditorToolbar.#l10nRemove[editorType]);[m
[31m-    this.#addListenersToElement(button);[m
[31m-    button.addEventListener("click", e => {[m
[31m-      _uiManager.delete();[m
[31m-    }, {[m
[31m-      signal: _uiManager._signal[m
[31m-    });[m
[31m-    this.#buttons.append(button);[m
[31m-  }[m
[31m-  get #divider() {[m
[31m-    const divider = document.createElement("div");[m
[31m-    divider.className = "divider";[m
[31m-    return divider;[m
[31m-  }[m
[31m-  async addAltText(altText) {[m
[31m-    const button = await altText.render();[m
[31m-    this.#addListenersToElement(button);[m
[31m-    this.#buttons.prepend(button, this.#divider);[m
[31m-    this.#altText = altText;[m
[31m-  }[m
[31m-  addColorPicker(colorPicker) {[m
[31m-    this.#colorPicker = colorPicker;[m
[31m-    const button = colorPicker.renderButton();[m
[31m-    this.#addListenersToElement(button);[m
[31m-    this.#buttons.prepend(button, this.#divider);[m
[31m-  }[m
[31m-  async addEditSignatureButton(signatureManager) {[m
[31m-    const button = this.#signatureDescriptionButton = await signatureManager.renderEditButton(this.#editor);[m
[31m-    this.#addListenersToElement(button);[m
[31m-    this.#buttons.prepend(button, this.#divider);[m
[31m-  }[m
[31m-  updateEditSignatureButton(description) {[m
[31m-    if (this.#signatureDescriptionButton) {[m
[31m-      this.#signatureDescriptionButton.title = description;[m
[31m-    }[m
[31m-  }[m
[31m-  remove() {[m
[31m-    this.#toolbar.remove();[m
[31m-    this.#colorPicker?.destroy();[m
[31m-    this.#colorPicker = null;[m
[31m-  }[m
[31m-}[m
[31m-class HighlightToolbar {[m
[31m-  #buttons = nu